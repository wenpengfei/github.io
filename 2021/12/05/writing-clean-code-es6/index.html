<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 写出整洁的 JavaScript 代码 ES6 版 · 夜色镇歌</title><meta name="description" content="写出整洁的 JavaScript 代码 ES6 版 - 文鹏飞"><meta name="baidu_union_verify" content="72cef2f38e5e048b980ace9972697c53"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://catwen.cn/atom.xml" title="夜色镇歌"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">文章</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">归档</a></li><li class="nav-list-item"><a href="http://weibo.com/333241589" target="_blank" class="nav-list-link">微博</a></li><li class="nav-list-item"><a href="https://github.com/wenpengfei" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">写出整洁的 JavaScript 代码 ES6 版</h1><div class="post-info">2021年12月5日</div><div class="post-content"><p>好的代码不仅仅是可以跑起来的代码，更是可以被其他人轻松阅读、重用和重构的代码，因为代码除了实现功能外，大部分的时间都是要被你或是团队其他成员维护的。</p>
<p><img src="/images/writing-clean-code-es6/1.png" style="width:80%"></p>
<p>虽然本文主要专注于编写干净整洁的 <a href="https://262.ecma-international.org/6.0/" target="_blank" rel="noopener">JavaScript ES6</a> 代码，并且不与任何框架相关，但是下面将要提到的绝大多数示例也适用于其他语言，另外，下面的示例也主要是从 Robert C. Martin 的书 <a href="https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882" target="_blank" rel="noopener">Clean Code</a> 中所采纳的建议，也不意味着要严格遵守。</p>
<h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><h2 id="使用有意义的名字"><a href="#使用有意义的名字" class="headerlink" title="使用有意义的名字"></a>使用有意义的名字</h2><p>变量的命名应该是描述性并且应该是有意义的，经验法则是大多数 JavaScript 变量应该使用<code>驼峰命名法</code>（camelCase）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误 ❌</span></span><br><span class="line"><span class="keyword">const</span> foo = <span class="string">"JDoe@example.com"</span>;</span><br><span class="line"><span class="keyword">const</span> bar = <span class="string">"John"</span>;</span><br><span class="line"><span class="keyword">const</span> age = <span class="number">23</span>;</span><br><span class="line"><span class="keyword">const</span> qux = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确 ✅</span></span><br><span class="line"><span class="keyword">const</span> email = <span class="string">"John@example.com"</span>;</span><br><span class="line"><span class="keyword">const</span> firstName = <span class="string">"John"</span>;</span><br><span class="line"><span class="keyword">const</span> age = <span class="number">23</span>;</span><br><span class="line"><span class="keyword">const</span> isActive = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意，布尔类型的变量名通常像是在回答问题，例如：</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">isActive</span><br><span class="line">didSubscribe</span><br><span class="line">hasLinkedAccount</span><br></pre></td></tr></table></figure>
<h2 id="避免添加不必要的上下文"><a href="#避免添加不必要的上下文" class="headerlink" title="避免添加不必要的上下文"></a>避免添加不必要的上下文</h2><p>在特定的对象或类中不需要加冗余的上下文</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误 ❌</span></span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  userId: <span class="string">"296e2589-7b33-400a-b762-007b730c8e6d"</span>,</span><br><span class="line">  userEmail: <span class="string">"JDoe@example.com"</span>,</span><br><span class="line">  userFirstName: <span class="string">"John"</span>,</span><br><span class="line">  userLastName: <span class="string">"Doe"</span>,</span><br><span class="line">  userAge: <span class="number">23</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">user.userId;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确 ✅</span></span><br><span class="line"><span class="keyword">const</span> user = &#123;</span><br><span class="line">  id: <span class="string">"296e2589-7b33-400a-b762-007b730c8e6d"</span>,</span><br><span class="line">  email: <span class="string">"JDoe@example.com"</span>,</span><br><span class="line">  firstName: <span class="string">"John"</span>,</span><br><span class="line">  lastName: <span class="string">"Doe"</span>,</span><br><span class="line">  age: <span class="number">23</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">user.id;</span><br></pre></td></tr></table></figure>
<h2 id="避免硬编码"><a href="#避免硬编码" class="headerlink" title="避免硬编码"></a>避免硬编码</h2><p>确保声明有意义且可搜索的常量，而不是直接使用一个常量值，全局变量建议使用<code>蛇形命名法</code>（SCREAMING_SNAKE_CASE）</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误 ❌</span></span><br><span class="line">setTimeout(clearSessionData, <span class="number">900000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确 ✅</span></span><br><span class="line"><span class="keyword">const</span> SESSION_DURATION_MS = <span class="number">15</span> * <span class="number">60</span> * <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">setTimeout(clearSessionData, SESSION_DURATION_MS);</span><br></pre></td></tr></table></figure>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><h2 id="使用描述性的命名"><a href="#使用描述性的命名" class="headerlink" title="使用描述性的命名"></a>使用描述性的命名</h2><p>函数名可以很长，长到足以描述它的作用，一般函数中都含有<code>动词</code>来描述它所做的事情，但是返回布尔值的函数是个例外，一般是一个回答“是”或者“否”的问题形式，另外函数命名也应该是驼峰命名法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误 ❌</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toggle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">agreed</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确 ✅</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">toggleThemeSwitcher</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">didAgreeToAllTerms</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="使用默认参数"><a href="#使用默认参数" class="headerlink" title="使用默认参数"></a>使用默认参数</h2><p>直接使用默认值比短路语法或者在函数中加入判断语句更加简洁，值得注意的是，短路语法适用于所有被认为是 <code>false</code> 的值，例如 <code>false</code>、<code>null</code>、<code>undefined</code>、<code>&#39;&#39;</code>、<code>&quot;&quot;</code>、<code>0</code> 和 <code>NaN</code>，而默认参数仅替换 <code>undefined</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误 ❌</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printAllFilesInDirectory</span>(<span class="params">dir</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> directory = dir || <span class="string">"./"</span>;</span><br><span class="line">  <span class="comment">//   ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确 ✅</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">printAllFilesInDirectory</span>(<span class="params">dir = <span class="string">"./"</span></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="限制参数个数"><a href="#限制参数个数" class="headerlink" title="限制参数个数"></a>限制参数个数</h2><p>这一条有争议，函数的参数应该<code>不多于2个</code>，意思是函数的参数为 0 个 1 个或者 2 个，如果需要第三个参数的话说明：</p>
<ul>
<li>函数需要拆分</li>
<li>可以把相关参数聚合成对象传递</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误 ❌</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendPushNotification</span>(<span class="params">title, message, image, isSilent, delayMs</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sendPushNotification(<span class="string">"New Message"</span>, <span class="string">"..."</span>, <span class="string">"http://..."</span>, <span class="literal">false</span>, <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确 ✅</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendPushNotification</span>(<span class="params">&#123; title, message, image, isSilent, delayMs &#125;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> notificationConfig = &#123;</span><br><span class="line">  title: <span class="string">"New Message"</span>,</span><br><span class="line">  message: <span class="string">"..."</span>,</span><br><span class="line">  image: <span class="string">"http://..."</span>,</span><br><span class="line">  isSilent: <span class="literal">false</span>,</span><br><span class="line">  delayMs: <span class="number">1000</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">sendPushNotification(notificationConfig);</span><br></pre></td></tr></table></figure>
<h2 id="不要在一个函数中做太多事情"><a href="#不要在一个函数中做太多事情" class="headerlink" title="不要在一个函数中做太多事情"></a>不要在一个函数中做太多事情</h2><p>原则上一个函数只做一件事，这一原则可以很好地帮助我们降低函数的体积和复杂度，也能更好的测试、调试和重构，一个函数的代码行数是判断这个函数是否做太多事情的一个指标，一般建议一个函数长度小于 20~30 行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误 ❌</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pingUsers</span>(<span class="params">users</span>) </span>&#123;</span><br><span class="line">  users.forEach(<span class="function">(<span class="params">user</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> userRecord = database.lookup(user);</span><br><span class="line">    <span class="keyword">if</span> (!userRecord.isActive()) &#123;</span><br><span class="line">      ping(user);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确 ✅</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">pingInactiveUsers</span>(<span class="params">users</span>) </span>&#123;</span><br><span class="line">  users.filter(!isUserActive).forEach(ping);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isUserActive</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> userRecord = database.lookup(user);</span><br><span class="line">  <span class="keyword">return</span> userRecord.isActive();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="避免使用-flag-变量"><a href="#避免使用-flag-变量" class="headerlink" title="避免使用 flag 变量"></a>避免使用 flag 变量</h2><p>flag 变量意味着函数可以被进一步简化</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误 ❌</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFile</span>(<span class="params">name, isPublic</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (isPublic) &#123;</span><br><span class="line">    fs.create(<span class="string">`./public/<span class="subst">$&#123;name&#125;</span>`</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fs.create(name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确 ✅</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createFile</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  fs.create(name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">createPublicFile</span>(<span class="params">name</span>) </span>&#123;</span><br><span class="line">  createFile(<span class="string">`./public/<span class="subst">$&#123;name&#125;</span>`</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="不要重复自己（DRY）"><a href="#不要重复自己（DRY）" class="headerlink" title="不要重复自己（DRY）"></a>不要重复自己（DRY）</h2><p>重复的代码不是一个好的信号，你复制粘贴了 N 次，下次这部分代码修改的时候你就要就要同时修改 N 个地方。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误 ❌</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderCarsList</span>(<span class="params">cars</span>) </span>&#123;</span><br><span class="line">  cars.forEach(<span class="function">(<span class="params">car</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> price = car.getPrice();</span><br><span class="line">    <span class="keyword">const</span> make = car.getMake();</span><br><span class="line">    <span class="keyword">const</span> brand = car.getBrand();</span><br><span class="line">    <span class="keyword">const</span> nbOfDoors = car.getNbOfDoors();</span><br><span class="line"></span><br><span class="line">    render(&#123; price, make, brand, nbOfDoors &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderMotorcyclesList</span>(<span class="params">motorcycles</span>) </span>&#123;</span><br><span class="line">  motorcycles.forEach(<span class="function">(<span class="params">motorcycle</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> price = motorcycle.getPrice();</span><br><span class="line">    <span class="keyword">const</span> make = motorcycle.getMake();</span><br><span class="line">    <span class="keyword">const</span> brand = motorcycle.getBrand();</span><br><span class="line">    <span class="keyword">const</span> seatHeight = motorcycle.getSeatHeight();</span><br><span class="line"></span><br><span class="line">    render(&#123; price, make, brand, seatHeight &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确 ✅</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">renderVehiclesList</span>(<span class="params">vehicles</span>) </span>&#123;</span><br><span class="line">  vehicles.forEach(<span class="function">(<span class="params">vehicle</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> price = vehicle.getPrice();</span><br><span class="line">    <span class="keyword">const</span> make = vehicle.getMake();</span><br><span class="line">    <span class="keyword">const</span> brand = vehicle.getBrand();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> data = &#123; price, make, brand &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">switch</span> (vehicle.type) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"car"</span>:</span><br><span class="line">        data.nbOfDoors = vehicle.getNbOfDoors();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">"motorcycle"</span>:</span><br><span class="line">        data.seatHeight = vehicle.getSeatHeight();</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    render(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="避免副作用"><a href="#避免副作用" class="headerlink" title="避免副作用"></a>避免副作用</h2><p>在 JavaScript 中，首选的模式应该是函数式而不是命令式，换句话说，要保证函数的纯粹性，副作用可以修改共享的状态和资源，会导致代码的不稳定和难以测试，排查问题也会特别棘手，所有的副作用应该集中管理。如果需要修改全局状态可以定义一个统一的服务去修改。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误 ❌</span></span><br><span class="line"><span class="keyword">let</span> date = <span class="string">"21-8-2021"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">splitIntoDayMonthYear</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  date = date.split(<span class="string">"-"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">splitIntoDayMonthYear();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Another function could be expecting date as a string</span></span><br><span class="line"><span class="built_in">console</span>.log(date); <span class="comment">// ['21', '8', '2021'];</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确 ✅</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">splitIntoDayMonthYear</span>(<span class="params">date</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> date.split(<span class="string">"-"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> date = <span class="string">"21-8-2021"</span>;</span><br><span class="line"><span class="keyword">const</span> newDate = splitIntoDayMonthYear(date);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Original vlaue is intact</span></span><br><span class="line"><span class="built_in">console</span>.log(date); <span class="comment">// '21-8-2021';</span></span><br><span class="line"><span class="built_in">console</span>.log(newDate); <span class="comment">// ['21', '8', '2021'];</span></span><br></pre></td></tr></table></figure>
<p>另外，如果一个可变的对象作为一个函数的参数传递进去，返回这个参数的时候应该是这个参数的克隆对象而不是直接把这个对象修改后返回。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 错误 ❌</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enrollStudentInCourse</span>(<span class="params">course, student</span>) </span>&#123;</span><br><span class="line">  course.push(&#123; student, <span class="attr">enrollmentDate</span>: <span class="built_in">Date</span>.now() &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确 ✅</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">enrollStudentInCourse</span>(<span class="params">course, student</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> [...course, &#123; student, <span class="attr">enrollmentDate</span>: <span class="built_in">Date</span>.now() &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="并发"><a href="#并发" class="headerlink" title="并发"></a>并发</h1><h2 id="避免使用回调"><a href="#避免使用回调" class="headerlink" title="避免使用回调"></a>避免使用回调</h2><p><a href="https://developer.mozilla.org/en-US/docs/Glossary/Callback_function" target="_blank" rel="noopener">回调函数</a> 太乱了，所以 ES6 给我们提供了 <a href="https://developer.mozilla.org/en-US/docs/Glossary/Callback_function" target="_blank" rel="noopener">Promise</a> 允许我们使用链式的回调，当然 <a href="https://developer.mozilla.org/en-US/docs/Glossary/Callback_function" target="_blank" rel="noopener">Async/Await</a> 提供了更简洁的方案，可以让我们写出更加线性的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误 ❌</span></span><br><span class="line">getUser(<span class="function"><span class="keyword">function</span> (<span class="params">err, user</span>) </span>&#123;</span><br><span class="line">  getProfile(user, <span class="function"><span class="keyword">function</span> (<span class="params">err, profile</span>) </span>&#123;</span><br><span class="line">    getAccount(profile, <span class="function"><span class="keyword">function</span> (<span class="params">err, account</span>) </span>&#123;</span><br><span class="line">      getReports(account, <span class="function"><span class="keyword">function</span> (<span class="params">err, reports</span>) </span>&#123;</span><br><span class="line">        sendStatistics(reports, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">          <span class="built_in">console</span>.error(err);</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确 ✅</span></span><br><span class="line">getUser()</span><br><span class="line">  .then(getProfile)</span><br><span class="line">  .then(getAccount)</span><br><span class="line">  .then(getReports)</span><br><span class="line">  .then(sendStatistics)</span><br><span class="line">  .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> <span class="built_in">console</span>.error(err));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确 ✅✅</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">sendUserStatistics</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> user = <span class="keyword">await</span> getUser();</span><br><span class="line">    <span class="keyword">const</span> profile = <span class="keyword">await</span> getProfile(user);</span><br><span class="line">    <span class="keyword">const</span> account = <span class="keyword">await</span> getAccount(profile);</span><br><span class="line">    <span class="keyword">const</span> reports = <span class="keyword">await</span> getReports(account);</span><br><span class="line">    <span class="keyword">return</span> sendStatistics(reports);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h1><h2 id="处理抛出的异常和-rejected-的-Promise"><a href="#处理抛出的异常和-rejected-的-Promise" class="headerlink" title="处理抛出的异常和 rejected 的 Promise"></a>处理抛出的异常和 rejected 的 Promise</h2><p>正确的处理异常可以使我们的代码更加的简装，也会更方便的排查问题。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误 ❌</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// 可能出错的代码</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(e);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确 ✅</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="comment">// 可能出错的代码</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">  <span class="comment">// 比 console.log 更合适</span></span><br><span class="line">  <span class="built_in">console</span>.error(e);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通知用户</span></span><br><span class="line">  alertUserOfError(e);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 通知服务器</span></span><br><span class="line">  reportErrorToServer(e);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 使用自定义的异常处理</span></span><br><span class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> CustomError(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h1><h2 id="只为复杂的逻辑添加注释"><a href="#只为复杂的逻辑添加注释" class="headerlink" title="只为复杂的逻辑添加注释"></a>只为复杂的逻辑添加注释</h2><p>不要过度的添加注释，只需要为复杂的逻辑添加即可。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 错误 ❌</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateHash</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// 哈希变量</span></span><br><span class="line">  <span class="keyword">let</span> hash = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 获取字符串的长度</span></span><br><span class="line">  <span class="keyword">let</span> length = str.length;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 如果长度是空的就返回</span></span><br><span class="line">  <span class="keyword">if</span> (!length) &#123;</span><br><span class="line">    <span class="keyword">return</span> hash;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 遍历字符</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="comment">// 获取字符 code</span></span><br><span class="line">    <span class="keyword">const</span> char = str.charCodeAt(i);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 为 hash 赋值</span></span><br><span class="line">    hash = (hash &lt;&lt; <span class="number">5</span>) - hash + char;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 转换为 32 位的整型</span></span><br><span class="line">    hash &amp;= hash;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确 ✅</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateHash</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> hash = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">let</span> length = str.length;</span><br><span class="line">  <span class="keyword">if</span> (!length) &#123;</span><br><span class="line">    <span class="keyword">return</span> hash;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="keyword">const</span> char = str.charCodeAt(i);</span><br><span class="line">    hash = (hash &lt;&lt; <span class="number">5</span>) - hash + char;</span><br><span class="line">    hash = hash &amp; hash; <span class="comment">// 转换为 32 位的整型</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> hash;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="版本控制"><a href="#版本控制" class="headerlink" title="版本控制"></a>版本控制</h2><p>完全没有必要写代码的修改历史，版本管理（比如 git ）已经帮我们做了这些事情。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 错误 ❌</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2021-7-21: Fixed corner case</span></span><br><span class="line"><span class="comment"> * 2021-7-15: Improved performance</span></span><br><span class="line"><span class="comment"> * 2021-7-10: Handled mutliple user types</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateCanonicalLink</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// const session = getUserSession(user)</span></span><br><span class="line">  <span class="keyword">const</span> session = user.getSession();</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 正确 ✅</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generateCanonicalLink</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> session = user.getSession();</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>本文简短的讨论了一些可以提高 <a href="https://262.ecma-international.org/6.0/" target="_blank" rel="noopener">ES6</a> 代码可读性的原则和方法，绝大多数原则可以应用到其他编程语言上，使用这些原则可能会比较花时间，但是长远来看它可以保证你代码的可读性可扩展性。</p>
</div></article></div></main><footer><div class="paginator"><a href="/2021/11/27/typescript-best-practices-2021/" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2021 <a href="https://catwen.cn">文鹏飞</a></p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script data-ad-client="ca-pub-9719602535480843" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "https://hm.baidu.com/hm.js?508f12c140e77c01b9acd8055bcea5e2";
var s = document.getElementsByTagName("script")[0]; 
s.parentNode.insertBefore(hm, s);
})();</script></body></html>